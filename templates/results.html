<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Results</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        th, td {
            padding: 8px;
            border: 1px solid #ddd;
            text-align: left;
        }

        th {
            background-color: #f5f5f5;
        }

        .compact-table {
            width: 30%; /* Reduce width */
        }

        .compact-table th, .compact-table td {
            padding: 8px; /* Match padding with the Attendance Table */
        }
    </style>
</head>
<body>
    <h1>{{ heading }}</h1>
    {% if employees %}
        <h2>Attendance Table</h2>
        <table>
            <thead>
                <tr>
                    <th>Employee Name</th>
                    <th>Employee Code</th>
                    <th>Present</th>
                    <th>Absent</th>
                    <th>Total Duration</th>
                    <!-- <th>Non-Business Day</th> -->
                    <th>Days of Absent</th>
                </tr>
            </thead>
            <tbody>
                {% for employee in employees %}
                    {% for attendance in employee['attendance'] %}
                        <tr>
                            <td>{{ employee['employee']['Employee Name'] }}</td>
                            <td>{{ employee['employee']['Employee Code'] }}</td>
                            <td>{{ attendance['Present'] }}</td>
                            <!-- <td>{{ attendance['Absent'] }}</td> -->
                            <td>{% set absent_days = [] %}
                                {% for date, mark in attendance.items() if mark == 'A' and date != 'Date' %}
                                    {% set day = date.split('-')[1] %}
                                    {% if date.split('-')[1] not in ['Sat', 'Sun'] %}
                                        {% set _ = absent_days.append(date.split('-')[0]) %}
                                    {% endif %}
                                {% endfor %}
                                {% set total = absent_days | count %}
                                {{ total }}</td>
                            <td>{{ attendance['Total Duration'] }}</td>
                            <!-- <td>{{ "Yes" if attendance['Non-Business Day'] else "No" }}</td> -->
                            <td>
                                {% set absent_dates = [] %}
                                {% for date, mark in attendance.items() if mark == 'A' and date != 'Date' %}
                                    {% set day = date.split('-')[1] %}
                                    {% if date.split('-')[1] not in ['Sat', 'Sun'] %}
                                        {% set _ = absent_dates.append(date.split('-')[0]) %}
                                    {% endif %}
                                {% endfor %}
                                {{ absent_dates|join(', ') }}
                            </td>
                        </tr>
                    {% endfor %}
                {% endfor %}
            </tbody>
        </table>
        <form action="/download_csv" method="POST">
            <input type="hidden" name="csv_data" value="{{ csv_data }}">
            <button type="submit">Download CSV</button>
        </form>
    {% else %}
        <p>No employees found with this reporting manager's PSI ID.</p>
    {% endif %}

    <h2>Non-Business Days Table</h2>
    {% if non_business_days %}
        <table class="compact-table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Reason</th>
                </tr>
            </thead>
            <tbody>
                {% for entry in non_business_days %}
                    <tr>
                        <td>{{ entry['Date'] }}</td>
                        <td>{{ entry['Reason'] }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No non-business days data available.</p>
    {% endif %}
</body>
</html>
